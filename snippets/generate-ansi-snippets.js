import { execSync, spawnSync } from "child_process";
import { writeFileSync } from "fs";

function runBat(filename) {
  return execSync(`bat -p --color always --theme ansi ${filename}`, { encoding: "utf8" });
}

function runVitest() {
  return spawnSync("npm", ["exec", "vitest", "--", "--run", "--color", "--reporter", "verbose"], {
    encoding: "utf8",
  });
}

function runScreenfetch() {
  return spawnSync("screenfetch", ["-A", "Mac OS X"], { encoding: "utf8" });
}

const elixir = runBat("elixir.ex");
const python = runBat("python.py");
const typescript = runBat("typescript.ts");
const vitest = runVitest();
const screenfetch = runScreenfetch();

const template = `/*
 * Autogenerated file.
 * Do not touch
 * Willy
 */

export const elixirSnippet = \`${elixir}\`;

export const pythonSnippet = \`${python}\`;

export const typescriptSnippet = \`${typescript}\`;

export const vitestSnippet = \`${vitest.stdout}
${vitest.stderr}\`;

export const screenfetchSnippet = \`${screenfetch.stdout.replaceAll("`", "\\`")}\`;
`;

writeFileSync("../src/lib/snippets.ts", template, "utf8");

console.log("Donesies");
